"story_id","epic","title","user_role","description","business_value","priority","story_points","dependencies","acceptance_criteria","technical_tasks","definition_of_done"
"US-004","Authentication & RBAC Implementation","Secure Login with Role-Based Access Control","Merchant User (Owner, Admin, Analyst)","As a registered merchant user, I want to log in securely using my credentials so that I can access my tenant-specific dashboard and features authorized for my role.","Ensures secure access to sensitive business data and enforces tenant isolation, preventing unauthorized data exposure.","Must Have","5","[""WI-001"",""WI-002""]","[{""scenario"":""Successful login with valid credentials"",""given"":""The user is on the login page and has a valid account"",""when"":""The user enters valid email/password and submits"",""then"":""A JWT access token and HTTP-only refresh token are issued, and the user is redirected to the dashboard.""},{""scenario"":""Role-based redirect and access"",""given"":""A user with 'Analyst' role logs in"",""when"":""The system processes the login request"",""then"":""The user is granted access only to read-only analytics routes and blocked from 'Settings' or 'User Management' routes.""},{""scenario"":""Session persistence via Refresh Token"",""given"":""A user's access token has expired (15m)"",""when"":""The user attempts to navigate the app"",""then"":""The system silently rotates the refresh token and issues a new access token without forcing logout.""}]","[""WI-004: Implement JWT Authentication Service with RS256 signing"",""WI-005: Implement RBAC Middleware to intercept and validate requests""]","[""Login API endpoint returns 200 with tokens"",""Refresh token rotation is verified"",""RBAC middleware blocks unauthorized routes with 403"",""Unit tests cover token generation and validation logic""]"
"US-009","Onboarding & Salla Integration","Connect Store via Salla OAuth 2.0","Store Owner","As a Store Owner, I want to connect my Salla store using a secure OAuth flow so that the platform can automatically import my products, orders, and customer data for analysis.","Critical onboarding step that enables data ingestion; without this, the platform has no data to analyze.","Must Have","5","[""US-004""]","[{""scenario"":""Initiate OAuth connection"",""given"":""The user is logged in and on the 'Connect Store' page"",""when"":""The user clicks 'Connect Salla'"",""then"":""They are redirected to the Salla authorization page with a secure 'state' parameter to prevent CSRF.""},{""scenario"":""Handle OAuth Callback"",""given"":""The user approves access on Salla"",""when"":""Salla redirects back to the application callback URL with an auth code"",""then"":""The system exchanges the code for Access/Refresh tokens, encrypts them, and stores them in the database.""},{""scenario"":""Webhook Registration"",""given"":""The connection is successful"",""when"":""The token exchange completes"",""then"":""The system registers webhooks for 'order.created' and 'cart.updated' events.""}]","[""WI-006: Implement Salla OAuth 2.0 Flow API routes"",""WI-007: Develop Salla Webhook Handler Service with signature verification""]","[""OAuth flow completes successfully end-to-end"",""Salla tokens are stored encrypted in the DB"",""State parameter validation prevents CSRF"",""Webhook endpoint responds 200 to verification challenge""]"
"US-012","Onboarding & Salla Integration","Historical Data Sync Status & Progress","Store Owner","As a Store Owner, I want to see the progress of my historical data import so that I know when my dashboard is ready for full analysis.","Manages user expectations during long-running processes (12-24 months of data) and reduces perceived latency.","Must Have","8","[""US-009""]","[{""scenario"":""Start Background Sync Job"",""given"":""The user selected an import depth (12 or 24 months)"",""when"":""The sync starts"",""then"":""A background job is queued in Upstash QStash, and the UI displays a 'Syncing' status.""},{""scenario"":""Rate Limit Handling"",""given"":""The background job hits Salla API rate limits"",""when"":""A 429 error is received"",""then"":""The job automatically backs off and retries without failing the user-facing status.""},{""scenario"":""Completion Notification"",""given"":""The historical import finishes"",""when"":""All pages of data are processed"",""then"":""The merchant's status is updated to 'Active', and the dashboard refreshes with data.""}]","[""WI-008: Implement Historical Data Import Job with pagination logic"",""Integrate Upstash QStash for reliable async job execution""]","[""Background worker successfully paginates through Salla API"",""Sync progress (% complete) is updated in the database"",""Job handles API rate limits gracefully"",""Data is visible in PostgreSQL (OLTP) after sync""]"
"US-022","Data Pipeline & Analytics","Main Dashboard with Real-Time KPIs","Analyst","As an Analyst, I want to view a dashboard with key performance indicators (Sales, Orders, AOV) updated in near real-time so that I can monitor store performance immediately.","Provides the core value proposition of the platform: actionable, up-to-date business intelligence.","Must Have","13","[""WI-009"",""WI-003""]","[{""scenario"":""Data Latency Requirement"",""given"":""A new order is created in Salla"",""when"":""The webhook is processed and the ELT pipeline runs"",""then"":""The dashboard metrics reflect this new order within 5 minutes.""},{""scenario"":""Aggregated Metrics Display"",""given"":""The user selects 'Last 30 Days'"",""when"":""The dashboard loads"",""then"":""Sales, Orders, and AOV are aggregated correctly from ClickHouse and rendered in < 2.5s.""},{""scenario"":""Trend Visualization"",""given"":""Sales data exists"",""when"":""The user views the trend chart"",""then"":""Data is grouped by day/week as requested via the API.""}]","[""WI-009: Implement ELT Process for Postgres to ClickHouse Sync"",""WI-010: Develop Sales Trend Analysis API & UI using Recharts""]","[""ELT pipeline successfully moves data from Postgres to ClickHouse"",""Dashboard queries against ClickHouse execute in < 200ms"",""Frontend displays skeletons while loading"",""Data accuracy validated against source""]"
"US-035","AI Assistant (RAG Implementation)","Natural Language Business Queries","Merchant User","As a non-technical Merchant, I want to ask questions like 'What were my best selling products last week?' so that I can get insights without configuring complex reports.","Democratizes access to data, allowing users without analytics expertise to derive value, significantly increasing engagement.","Should Have","13","[""US-022"",""WI-012""]","[{""scenario"":""Accurate SQL Generation"",""given"":""User asks 'Show total sales for yesterday'"",""when"":""The request is processed by the AI service"",""then"":""The system generates a valid ClickHouse SQL query restricted to the user's merchantID.""},{""scenario"":""Context Retrieval via RAG"",""given"":""User asks a vague question about 'performance'"",""when"":""The system constructs the prompt"",""then"":""Relevant schema context and data summaries are retrieved via pgvector to ground the LLM response.""},{""scenario"":""Tenant Isolation Enforcement"",""given"":""User asks a question"",""when"":""The SQL is generated"",""then"":""The query MUST include 'WHERE merchantId = X' to prevent data leakage.""}]","[""WI-012: Configure pgvector and Embedding Pipeline"",""WI-013: Implement RAG Query Service with OpenAI integration""]","[""RAG pipeline retrieves relevant context"",""Generated SQL is valid and secure (read-only)"",""Response time is within acceptable limits (< 5s)"",""Golden set of test queries pass consistently""]"
"US-041","Cart Recovery Module","Automated Abandoned Cart Campaigns","Marketer","As a Marketer, I want to configure automated email sequences for abandoned carts so that I can recover lost revenue without manual intervention.","Directly drives ROI for the merchant by converting lost sales, justifying the platform subscription cost.","Should Have","8","[""WI-014"",""WI-007""]","[{""scenario"":""Identify Abandoned Carts"",""given"":""A cart has not been updated for 60 minutes"",""when"":""The background workflow runs"",""then"":""The cart is flagged as 'Abandoned' and eligible for recovery.""},{""scenario"":""Send Recovery Email"",""given"":""An abandoned cart exists and matches a campaign rule"",""when"":""The scheduled time arrives"",""then"":""A personalized email is sent via Postmark using the configured template.""},{""scenario"":""Stop Sequence on Purchase"",""given"":""A recovery sequence is active"",""when"":""The user completes the purchase (order.created webhook)"",""then"":""The remaining scheduled emails for that cart are immediately cancelled.""}]","[""WI-014: Implement Rich Text Email Template Editor"",""WI-015: Develop Abandoned Cart Workflow Engine""]","[""Email editor saves valid HTML templates"",""Workflow engine correctly identifies abandoned carts"",""Emails are delivered via Postmark"",""Purchase events successfully terminate workflows""]"