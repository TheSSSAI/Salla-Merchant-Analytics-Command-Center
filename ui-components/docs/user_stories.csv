"story_id","epic","title","user_role","description","business_value","priority","story_points","dependencies","acceptance_criteria","technical_tasks","definition_of_done"
"US-009","Core Tenant Identity & Access Management","Connect Salla Store via OAuth","New Store Owner","As a new Store Owner, I want to securely connect my Salla store to the platform using standard OAuth, so that the system can access my store's data for analysis and cart recovery.","Critical conversion step that establishes the data link required for all platform functionality, unlocking value for the user.","Must Have","5","[""WI-AUTH-001""]","[{""scenario"":""Successful OAuth connection flow"",""given"":""I am a logged-in user on the onboarding page"",""when"":""I click 'Connect Salla Store' and approve permissions on the Salla authorization screen"",""then"":""I am redirected back to the app with a success message, and my access tokens are securely stored.""},{""scenario"":""Handling OAuth errors or denial"",""given"":""I am redirected to the Salla authorization screen"",""when"":""I click 'Deny' or a network error occurs during the callback"",""then"":""I am returned to the app with a clear, user-friendly error message explaining the failure and a 'Try Again' button.""},{""scenario"":""Security validation of state parameter"",""given"":""The OAuth callback is received by the backend"",""when"":""The 'state' parameter in the URL does not match the session state"",""then"":""The transaction is rejected immediately to prevent CSRF attacks.""}]","[""WI-AUTH-002: Salla OAuth 2.0 Integration Service"",""WI-AUTH-001: Prisma Schema Design for Identity""]","[""OAuth flow functions end-to-end in staging environment"",""Tokens are encrypted at rest in the database"",""CSRF protection is validated via security testing"",""Unit tests cover token exchange and error handling logic""]"
"US-012","High-Performance Data Pipeline","Real-time Data Synchronization & Status","Store Owner","As a Store Owner, I want my data to synchronize automatically and see the current status of ingestion, so that I can trust the analytics are up-to-date and know when new data is available.","Ensures data freshness (<5 mins) which is a core competitive advantage and builds user trust in the reporting accuracy.","Must Have","13","[""US-009"",""WI-DATA-002""]","[{""scenario"":""Webhook ingestion and queuing"",""given"":""A customer places an order on the Salla store"",""when"":""Salla sends the 'order.created' webhook"",""then"":""The system validates the signature, returns a 200 OK immediately, and queues the payload for processing.""},{""scenario"":""Data transformation and loading (ETL)"",""given"":""A raw event payload exists in the processing queue"",""when"":""The worker function processes the message"",""then"":""The data is transformed into the OLAP schema format and inserted into ClickHouse.""},{""scenario"":""Dashboard data freshness"",""given"":""An order was created 5 minutes ago"",""when"":""I view the Sales Dashboard"",""then"":""The aggregated metrics reflect this new order.""}]","[""WI-DATA-001: Salla Webhook Receiver & Signature Validation"",""WI-DATA-003: CDC Pipeline Worker Implementation"",""WI-DATA-002: ClickHouse Schema Definition (OLAP)""]","[""Signature validation enforces security on all webhooks"",""Data flows from Salla to ClickHouse in < 5 minutes"",""Idempotency is verified (duplicate webhooks do not corrupt data)"",""Dead Letter Queue configured for failed processing attempts""]"
"US-043","Cart Recovery Automation System","Design Email Templates with Rich Text Editor","Marketer","As a Marketer, I want to create email templates using a rich text editor with dynamic variables, so that I can send personalized and professional recovery emails to customers.","Enables creation of high-quality, personalized content which significantly increases recovery conversion rates.","Should Have","8","[""WI-AUTH-003""]","[{""scenario"":""Rich text formatting"",""given"":""I am on the email template creation page"",""when"":""I apply bold, italic, or list formatting to selected text"",""then"":""The editor reflects these styles visually and generates valid HTML output.""},{""scenario"":""Inserting dynamic variables"",""given"":""I am editing a template"",""when"":""I select the 'Customer Name' variable from the picker"",""then"":""The placeholder {{customer_name}} is inserted at the cursor position.""},{""scenario"":""Saving sanitized content"",""given"":""I have finished designing a template"",""when"":""I click 'Save'"",""then"":""The content is sanitized to prevent XSS attacks and stored in the database.""}]","[""WI-REC-001: Email Template Editor Component"",""WI-AUTH-003: Next.js Middleware for RBAC (for saving permissions)""]","[""Editor supports required formatting options and variable insertion"",""Output HTML is sanitized and safe for email clients"",""UI is responsive and keyboard accessible"",""Unit tests cover serialization and sanitation logic""]"
"US-041","Cart Recovery Automation System","Configure Automated Recovery Sequences","Marketer","As a Marketer, I want to configure rules and timing for cart recovery email sequences, so that the system automatically follows up with abandoned carts at the optimal time.","Automates revenue recovery operations, functioning as a 'set and forget' revenue driver for the merchant.","Must Have","8","[""US-043"",""US-012""]","[{""scenario"":""Scheduling a recovery job"",""given"":""An 'abandoned cart' event is detected via the data pipeline"",""when"":""The campaign is active"",""then"":""A background job is scheduled for the configured delay time (e.g., 1 hour).""},{""scenario"":""Cancelling sequence on purchase"",""given"":""A recovery email is scheduled for a specific cart"",""when"":""The customer completes the purchase (order.created event received) before the scheduled time"",""then"":""The scheduled email job is cancelled automatically to prevent spam.""},{""scenario"":""Executing the email send"",""given"":""The scheduled time for a recovery email has arrived"",""when"":""The job processor executes"",""then"":""The email is sent via Postmark using the correct template and dynamic data.""}]","[""WI-REC-002: Recovery Campaign Scheduler Service"",""WI-DATA-001: Salla Webhook Receiver (source of events)""]","[""Scheduler accurately handles delays"",""Cancellation logic is verified via integration tests"",""Postmark integration sends emails successfully"",""Execution logs are persisted for audit""]"
"US-035","AI Assistant & RAG Implementation","Ask Data Questions in Natural Language","Store Owner","As a Store Owner, I want to ask questions about my business data in plain language (e.g., 'What were my sales last week?'), so that I can get instant insights without needing to build complex reports.","Democratizes data access, allowing non-technical users to extract deep value from the analytics platform instantly.","Could Have","13","[""US-012"",""WI-AI-001""]","[{""scenario"":""Successful natural language query"",""given"":""I enter 'Show me top 5 products by revenue this month'"",""when"":""I submit the query"",""then"":""The system generates valid SQL, executes it against ClickHouse, and displays the correct list of products.""},{""scenario"":""Data privacy and scoping"",""given"":""I am logged in as Merchant A"",""when"":""The AI generates the SQL query"",""then"":""The query includes a strict 'WHERE merchant_id = X' clause to ensure I never see another merchant's data.""},{""scenario"":""Handling unanswerable questions"",""given"":""I ask a question unrelated to store data"",""when"":""The AI processes the request"",""then"":""It politely informs me that it can only answer questions related to store performance and analytics.""}]","[""WI-AI-002: NLQ to SQL Translation Service"",""WI-AI-001: pgvector Setup & Embedding Schema""]","[""Golden set of 50 test queries returns accurate results"",""SQL injection vulnerabilities are mitigated via validation"",""PII is scrubbed from prompts sent to OpenAI"",""Response time for queries is acceptable (< 5s)""]"