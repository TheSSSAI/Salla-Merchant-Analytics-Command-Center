"story_id","epic","title","user_role","description","business_value","priority","story_points","dependencies","acceptance_criteria","technical_tasks","definition_of_done"
"US-001","Authentication & Tenant Management","Secure Merchant Registration and Login","New Merchant","As a New Merchant, I want to securely register and log in to the platform using my email credentials so that I can access a protected, isolated workspace for my store data.","Establishes the secure entry point for the SaaS platform, ensuring tenant isolation and data security which is a fundamental requirement for trust and compliance.","Must Have","8","[]","[{""scenario"":""Successful Registration and Login"",""given"":""I am on the registration page"",""when"":""I enter a valid email, strong password, and submit"",""then"":""My account is created, a secure session (JWT) is established, and I am redirected to the onboarding flow""},{""scenario"":""Tenant Data Isolation Verification"",""given"":""I am a logged-in user"",""when"":""I attempt to access an API route"",""then"":""The middleware validates my RBAC permissions and injects my specific merchant_id into the request context""},{""scenario"":""Session Persistence"",""given"":""I have logged in previously"",""when"":""I return to the application within 30 days"",""then"":""My refresh token in the HTTP-only cookie automatically renews my access token without requiring re-login""}]","[""WI-INFRA-001: Configure Vercel Project & CI/CD Pipeline"",""WI-INFRA-002: Provision PostgreSQL OLTP Database with Prisma"",""WI-AUTH-001: Implement JWT Authentication Service"",""WI-AUTH-002: Develop Registration & Login UI with Validation"",""WI-AUTH-003: Implement RBAC Middleware & Tenant Isolation""]","[""JWT service implemented with RS256 signing"",""Secure HttpOnly cookie storage configured for refresh tokens"",""Middleware blocks unauthenticated requests to /dashboard/*"",""Unit tests for Auth service pass with >80% coverage"",""WCAG 2.1 AA compliant login forms""]"
"US-002","Data Ingestion & Synchronization Pipeline","Connect Salla Store via OAuth","Merchant Owner","As a Merchant Owner, I want to connect my Salla store using a secure OAuth 2.0 flow so that the platform can legally and securely access my store's data for analysis.","Enables the core value proposition by authorizing data access. Without this, the platform has no data to analyze.","Must Have","5","[""US-001""]","[{""scenario"":""Successful OAuth Handshake"",""given"":""I am on the 'Connect Store' onboarding step"",""when"":""I click 'Connect Salla' and authorize the app on the Salla portal"",""then"":""I am redirected back to the app, my access tokens are encrypted and stored, and the historical sync begins""},{""scenario"":""Security State Validation"",""given"":""I initiate the OAuth flow"",""when"":""The callback is received with an invalid 'state' parameter"",""then"":""The connection is rejected to prevent CSRF attacks""}]","[""WI-DATA-001: Implement Salla OAuth 2.0 Flow"",""Set up Salla App credentials in Vercel environment variables"",""Implement token encryption (AES-256) for storage""]","[""OAuth flow completes successfully end-to-end"",""Access and Refresh tokens are stored encrypted in PostgreSQL"",""Token refresh logic is handled automatically"",""Integration tests with Salla Sandbox pass""]"
"US-003","Data Ingestion & Synchronization Pipeline","Historical Data Synchronization","Merchant Owner","As a Merchant Owner, I want my historical store data (orders, products, customers) to be automatically imported so that I can see immediate analytics trends upon onboarding.","Provides immediate ""Day 1"" value to the user by populating dashboards with 12-24 months of history, preventing the ""empty dashboard"" problem.","Must Have","8","[""US-002""]","[{""scenario"":""Initial Data Import"",""given"":""I have just connected my store"",""when"":""The background sync job runs"",""then"":""All orders and products from the selected lookback period are fetched from Salla and stored in the database""},{""scenario"":""Rate Limit Handling"",""given"":""The sync job is running"",""when"":""The Salla API returns a 429 Too Many Requests"",""then"":""The job pauses and retries automatically using exponential backoff without failing""}]","[""WI-DATA-002: Develop Historical Data Import Worker"",""Configure Upstash QStash for long-running job scheduling"",""Implement checkpointing logic for resumable syncs""]","[""Background worker successfully paginates through Salla API"",""Data is correctly mapped to Prisma schema"",""Job handles timeouts and rate limits gracefully"",""Sync status is visible to the user (e.g., In Progress)""]"
"US-004","Deep Analytics & Reporting","Real-Time Dashboard Visualization","Data Analyst","As a Data Analyst, I want to view an interactive dashboard showing key metrics (Sales, AOV, Orders) and trend charts so that I can monitor the current health of my business.","Delivers the primary visual interface for business intelligence, allowing users to consume complex data effortlessly.","Must Have","8","[""US-003""]","[{""scenario"":""Dashboard Load Performance"",""given"":""I navigate to the dashboard"",""when"":""The page loads"",""then"":""The Largest Contentful Paint (LCP) occurs within 2.5 seconds and skeleton loaders are used during data fetch""},{""scenario"":""Data Accuracy"",""given"":""I am viewing the Sales KPI card"",""when"":""I verify the total against source data"",""then"":""The value matches the aggregated sum from the ClickHouse OLAP database""}]","[""WI-INFRA-003: Provision ClickHouse OLAP Data Warehouse"",""WI-DATA-004: Develop OLTP to OLAP Sync Worker"",""WI-ANA-001: Implement Analytics API Endpoints"",""WI-ANA-002: Develop Main Dashboard Components""]","[""Dashboard renders responsively on mobile and desktop"",""Recharts visualizations are interactive (tooltips active)"",""API response time is under 200ms (p95)"",""Data pipeline latency is confirmed < 5 minutes""]"
"US-005","Abandoned Cart Recovery System","Automated Abandoned Cart Detection","Marketing Manager","As a Marketing Manager, I want the system to automatically identify carts that have been inactive for 60 minutes so that I can target them for recovery campaigns.","Identifies lost revenue opportunities automatically, forming the trigger for the recovery funnel.","High","5","[""US-003""]","[{""scenario"":""Detect Abandoned Cart"",""given"":""A customer added items to a cart 61 minutes ago and has not checked out"",""when"":""The detection job runs"",""then"":""The cart is flagged as 'Abandoned' in the database and queued for recovery""},{""scenario"":""Ignore Active or Completed Carts"",""given"":""A cart was updated 10 minutes ago OR converted to an order"",""when"":""The detection job runs"",""then"":""The cart is NOT flagged as abandoned""}]","[""WI-DATA-003: Implement Salla Webhook Handler (cart.updated)"",""WI-CART-001: Implement Abandoned Cart Detector"",""Configure cron job via Vercel/QStash""]","[""Webhook handler verifies HMAC signature"",""Scheduled job runs reliably every 15 minutes"",""Logic correctly distinguishes between abandoned and active carts"",""Unit tests cover edge cases (e.g., cart converted to order just before job run)""]"
"US-006","Abandoned Cart Recovery System","Email Template Creation","Marketing Manager","As a Marketing Manager, I want to design email templates using a rich text editor with dynamic variables so that I can send personalized recovery messages to customers.","Enables personalization of marketing communications, which significantly increases conversion rates for recovery emails.","Should Have","5","[""US-001""]","[{""scenario"":""Create Template"",""given"":""I am in the template editor"",""when"":""I add text and insert the {{customer_name}} variable"",""then"":""The template saves successfully and renders the variable correctly in previews""},{""scenario"":""Security Validation"",""given"":""I attempt to paste malicious script tags into the editor"",""when"":""I save the template"",""then"":""The system sanitizes the HTML input to prevent XSS attacks""}]","[""WI-CART-002: Develop Email Template Editor"",""Integrate TipTap or Quill library"",""Implement variable interpolation logic""]","[""Rich text editor fully functional"",""Dynamic variables (Name, Cart Items) supported"",""HTML sanitization tests pass"",""UI components use shadcn/ui""]"
"US-007","Abandoned Cart Recovery System","Automated Recovery Email Dispatch","System","As a System, I want to automatically schedule and send recovery emails via Postmark based on the defined sequence so that lost sales are recovered without manual intervention.","Automates revenue recovery, converting lost sales into revenue with zero ongoing effort from the merchant.","High","8","[""US-005"",""US-006""]","[{""scenario"":""Send Scheduled Email"",""given"":""A cart has been abandoned and the configured delay (e.g., 1 hour) has passed"",""when"":""The scheduler executes"",""then"":""The correct email template is rendered and sent to the customer via Postmark""},{""scenario"":""Suppression Compliance"",""given"":""A customer has previously unsubscribed"",""when"":""Their cart is abandoned"",""then"":""The email is NOT sent""}]","[""WI-CART-003: Implement Sequence Scheduler & Sender"",""Integrate Postmark API for transactional sending"",""Implement suppression list check""]","[""Emails are delivered to test accounts"",""Unsubscribe links are functional"",""Postmark webhooks track delivery status"",""Scheduler handles retries for failed sends""]"
"US-008","Deep Analytics & Reporting","Date Range Filtering and CSV Export","Data Analyst","As a Data Analyst, I want to filter dashboard reports by custom date ranges and export the underlying data to CSV so that I can perform deep-dive analysis offline.","Enhances data usability and portability, allowing merchants to find specific insights and integrate data with other financial tools.","Should Have","5","[""US-004""]","[{""scenario"":""Filter Dashboard"",""given"":""I am viewing the dashboard"",""when"":""I select 'Last 30 Days' from the date picker"",""then"":""All charts update to reflect only data from that period and the URL is updated""},{""scenario"":""Export Large Dataset"",""given"":""I request a CSV export for a large dataset (>5000 rows)"",""when"":""I click export"",""then"":""The system processes it asynchronously and provides a secure download link when ready""}]","[""WI-ANA-003: Implement Date Range Filter Component"",""WI-ANA-004: Develop CSV Export Service"",""Configure Cloudflare R2 for temporary file storage""]","[""Date picker handles presets and custom ranges"",""URL synchronization works for shareable links"",""CSV export handles large files without memory exhaustion (streaming)"",""Export links are pre-signed and time-limited""]"
"US-009","AI Assistant & Insights","Natural Language Business Querying","Merchant Owner","As a Merchant Owner, I want to ask questions about my business in plain English (e.g., 'What were my best selling products last week?') so that I can get insights without learning SQL or complex report builders.","Democratizes data access, allowing non-technical users to extract high-value insights instantly.","Medium","13","[""US-004""]","[{""scenario"":""Ask Valid Question"",""given"":""I ask 'Show me total sales by city for last month'"",""when"":""I submit the query"",""then"":""The AI translates this to SQL, queries the database, and presents the correct data visualization""},{""scenario"":""Data Safety"",""given"":""I ask a question"",""when"":""The AI processes the request"",""then"":""It only accesses data belonging to my merchant_id, strictly enforcing tenant isolation""}]","[""WI-INFRA-002: Enable pgvector"",""WI-AI-001: Implement Vector Embedding Generation"",""WI-AI-002: Develop AI Chat Interface & API"",""Implement RAG pipeline with OpenAI""]","[""Embeddings are generated for database schema"",""Prompt engineering strictly enforces SQL read-only access"",""Response time is under 5 seconds"",""UI handles loading and error states gracefully""]"